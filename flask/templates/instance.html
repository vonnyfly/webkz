{% extends "layout.html" %}
{% block content %}
{% if session.logged_in %}
{% include 'errors_block.html' %}
{% include 'messages_block.html' %}
<h2>{{ instance_name }}</h2>
<div class="row" id="max-width-page">
   <div class="col-lg-12">
      <div role="tabpanel">
         <!-- Nav tabs -->
         <ul class="nav nav-pills" role="tablist" id="navbtn">
            <li role="presentation" class="active">
               <a href="#power" class="action-button" aria-controls="power" role="tab" data-toggle="tab">
               <span id="action-block" class="glyphicon glyphicon-off" aria-hidden="true"></span>
               Power
               </a>
            </li>
            <li role="presentation">
               <a href="#access" class="action-button" aria-controls="access" role="tab" data-toggle="tab">
               <span id="action-block" class="glyphicon glyphicon-lock" aria-hidden="true"></span>
               Access
               </a>
            </li>
            <li role="presentation">
               <a href="#resize" class="action-button" aria-controls="resize" role="tab" data-toggle="tab">
               <span id="action-block" class="glyphicon glyphicon-resize-full" aria-hidden="true"></span>
               Resize
               </a>
            </li>
            <li role="presentation">
               <a href="#snapshots" class="action-button" aria-controls="snapshots" role="tab" data-toggle="tab">
               <span id="action-block" class="glyphicon glyphicon-camera" aria-hidden="true"></span>
               Snapshots
               </a>
            </li>
            <li role="presentation">
               <a href="#settings" class="action-button" aria-controls="settings" role="tab" data-toggle="tab">
               <span id="action-block" class="glyphicon glyphicon-cog" aria-hidden="true"></span>
               Settings
               </a>
            </li>
            <li role="presentation">
               <a href="#graphics" id="chartgraphs" class="action-button" aria-controls="graphics" role="tab" data-toggle="tab">
               <span id="action-block" class="glyphicon glyphicon-signal" aria-hidden="true"></span>
               Graphs
               </a>
            </li>
            <li role="presentation">
               <a href="#undefine" class="action-button" aria-controls="undefine" role="tab" data-toggle="tab">
               <span id="action-block" class="glyphicon glyphicon-trash" aria-hidden="true"></span>
               Destroy
               </a>
            </li>
         </ul>
         <!-- Tab panes -->
         <div class="tab-content">
            <div role="tabpanel" class="tab-pane active" id="power">
               <div role="tabpanel">
                  <!-- Nav tabs -->
                  <ul class="nav nav-tabs" role="tablist">
                     {% if entry.status == "1" %}
                     <li role="presentation" class="active">
                        <a href="#poweroff" aria-controls="poweroff" role="tab" data-toggle="tab">
                        Power Off
                        </a>
                     </li>
                     <li role="presentation">
                        <a href="#powercycle" aria-controls="powercycle" role="tab" data-toggle="tab">
                        Power Cycle
                        </a>
                     </li>
                     <li role="presentation">
                        <a href="#powerforce" aria-controls="powerforce" role="tab" data-toggle="tab">
                        Force Off
                        </a>
                     </li>
                     <li role="presentation">
                        <a href="#suspend" aria-controls="suspend" role="tab" data-toggle="tab">
                        Suspend
                        </a>
                     </li>
                     {% endif %}
                     {% if entry.status == "1" %}
                     <li role="presentation" class="active">
                        <a href="#resume" aria-controls="resume" role="tab" data-toggle="tab">
                        Resume
                        </a>
                     </li>
                     {% endif %}
                     {% if entry.status == "1" %}
                     <li role="presentation" class="active">
                        <a href="#boot" aria-controls="boot" role="tab" data-toggle="tab">
                        Power On
                        </a>
                     </li>
                     {% endif %}
                  </ul>
                  <!-- Tab panes -->
                  <div class="tab-content">
                     {% if entry.status == "1" %}
                     <div role="tabpanel" class="tab-pane tab-pane-bordered active" id="poweroff">
                        <p> This action sends an ACPI shutdown signal to the instance. </p>
                        <form action="" method="post" role="form">
                           <input type="submit" name="poweroff" class="btn btn-lg btn-success pull-right" value=" Power Off ">
                           <div class="clearfix"></div>
                        </form>
                     </div>
                     <div role="tabpanel" class="tab-pane tab-pane-bordered" id="powercycle">
                        <p> This action forcibly powers off and start the instance and may cause data corruption. </p>
                        <form action="" method="post" role="form">
                           <input type="submit" name="powercycle" class="btn btn-lg btn-success pull-right" value=" Power Cycle ">
                           <div class="clearfix"></div>
                        </form>
                     </div>
                     <div role="tabpanel" class="tab-pane tab-pane-bordered" id="powerforce">
                        <p> This action forcibly powers off the instance and may cause data corruption. </p>
                        <form action="" method="post" role="form">
                           <input type="submit" name="powerforce" class="btn btn-lg btn-success pull-right" value=" Force Off ">
                           <div class="clearfix"></div>
                        </form>
                     </div>
                     <div role="tabpanel" class="tab-pane tab-pane-bordered" id="suspend">
                        <p> This action suspends the instance. </p>
                        <form action="" method="post" role="form">
                           <input type="submit" name="suspend" class="btn btn-lg btn-success pull-right" value=" Suspend ">
                           <div class="clearfix"></div>
                        </form>
                     </div>
                     {% endif %}
                     {% if entry.status == "1" %}
                     <div role="tabpanel" class="tab-pane tab-pane-bordered active" id="resume">
                        <p> This action restore the instance after suspend. </p>
                        <form action="" method="post" role="form">
                           <input type="submit" name="resume" class="btn btn-lg btn-success pull-right" value=" Resume ">
                           <div class="clearfix"></div>
                        </form>
                     </div>
                     {% endif %}
                     {% if entry.status == "1" %}
                     <div role="tabpanel" class="tab-pane tab-pane-bordered active" id="boot">
                        <p> Click on Boot button to start this instance. </p>
                        <form action="" method="post" role="form">
                           <input type="submit" name="poweron" class="btn btn-lg btn-success pull-right" value=" Power On ">
                           <div class="clearfix"></div>
                        </form>
                     </div>
                     {% endif %}
                  </div>
               </div>
            </div>
            <div role="tabpanel" class="tab-pane" id="access">
               <div role="tabpanel">
                  <!-- Nav tabs -->
                  <ul class="nav nav-tabs" role="tablist">
                     <li role="presentation" class="active">
                        <a href="#vnconsole" aria-controls="vnconsole" role="tab" data-toggle="tab">
                        Console
                        </a>
                     </li>
                     <li role="presentation">
                        <a href="#rootpasswd" aria-controls="rootpasswd" role="tab" data-toggle="tab">
                        Root Password
                        </a>
                     </li>
                     <li role="presentation">
                        <a href="#sshkeys" aria-controls="sshkeys" role="tab" data-toggle="tab">
                        SSH Keys
                        </a>
                     </li>
                  </ul>
                  <!-- Tab panes -->
                  <div class="tab-content">
                     <div role="tabpanel" class="tab-pane tab-pane-bordered active" id="vnconsole">
                        <p> This action opens a new window with a VNC connection to the console of the instance. </p>
                        {% if entry.status == "1" %}
                        <a href="#" class="btn btn-lg btn-success pull-right" title="Console port: {{ console_port }}" onclick="open_console()"> Console </a>
                        {% else %}
                        <button class="btn btn-lg btn-success pull-right disabled"> Console </button>
                        {% endif %}
                        <div class="clearfix"></div>
                     </div>
                     <div role="tabpanel" class="tab-pane tab-pane-bordered" id="rootpasswd">
                        <p> You need shut down your instance and enter a new root password. </p>
                        <form class="form-inline" method="post" role="form">
                           <div class="form-group">
                              <div class="col-sm-12">
                                 <input type="text" class="form-control input-lg" name="passwd" placeholder=" Enter Password " maxlength="24">
                              </div>
                           </div>
                           {% if entry.status == "1" %}
                           <input type="submit" class="btn btn-lg btn-success pull-right" name="rootpasswd" value=" Reset Root Password ">
                           {% else %}
                           <button class="btn btn-lg btn-success pull-right disabled"> Reset Root Password </button>
                           {% endif %}
                        </form>
                        <div class="clearfix"></div>
                     </div>
                     <div role="tabpanel" class="tab-pane tab-pane-bordered" id="sshkeys">
                        <p> You need shut down your instance and choose your public key. </p>
                        <form class="form-inline" method="post" role="form">
                           <div class="form-group">
                              <div class="col-sm-12">
                                 <select name="sshkeyid" class="form-control keyselect">
                                    {% if publickeys %}
                                    {% for key in publickeys %}
                                    <option value="{{ key.id }}">{{ key.keyname }}</option>
                                    {% endfor %}
                                    {% else %}
                                    <option value="None"> None </option>
                                    {% endif %}
                                 </select>
                              </div>
                           </div>
                           {% if entry.status == "1" %}
                           <input type="submit" class="btn btn-lg btn-success pull-right" name="addpublickey" value=" Add Public Key ">
                           {% else %}
                           <button class="btn btn-lg btn-success pull-right disabled"> Add Public Key </button>
                           {% endif %}
                        </form>
                        <div class="clearfix"></div>
                     </div>
                  </div>
               </div>
            </div>
            <div role="tabpanel" class="tab-pane" id="resize">
               <div role="tabpanel">
                  <!-- Nav tabs -->
                  <ul class="nav nav-tabs" role="tablist">
                     <li role="presentation" class="active">
                        <a href="#resizevm" aria-controls="resizevm" role="tab" data-toggle="tab">
                        Resize Instance
                        </a>
                     </li>
                  </ul>
                  <!-- Tab panes -->
                  <div class="tab-content">
                     <div role="tabpanel" class="tab-pane tab-pane-bordered active" id="resizevm">
                        <form class="form-horizontal" method="post" role="form">
                           <p style="font-weight:bold;"> Logical host CPUs:  {{ vcpu_host }}</p>
                           <div class="form-group">
                              <label class="col-sm-4 control-label" style="font-weight:normal;">  Current allocation </label>
                              <div class="col-sm-4">
                                 <select name="cur_vcpu" class="form-control">
                                 {% for cpu in vcpu_range %}
                                 {% if cur_vcpu %}
                                 <option value="{{ cpu }}" {% if cpu == cur_vcpu %}selected{% endif %}>{{ cpu }}</option>
                                 {% else %}
                                 <option value="{{ cpu }}" {% if cpu == vcpu %}selected{% endif %}>{{ cpu }}</option>
                                 {% endif %}
                                 {% endfor %}
                                 </select>
                              </div>
                           </div>
                           <div class="form-group">
                              <label class="col-sm-4 control-label" style="font-weight:normal;"> Maximum allocation </label>
                              <div class="col-sm-4">
                                 <select name="vcpu" class="form-control">
                                 {% for cpu in vcpu_range %}
                                 <option value="{{ cpu }}" {% if cpu == vcpu %}selected{% endif %}>{{ cpu }}</option>
                                 {% endfor %}
                                 </select>
                              </div>
                           </div>
                           <p style="font-weight:bold;"> Total host memory:  </p>
                           <div class="form-group">
                              <label class="col-sm-4 control-label" style="font-weight:normal;"> Current allocation  ( MB )</label>
                              <div class="col-sm-4 js-custom__container">
                                 <select name="cur_memory" class="form-control js-custom__toggle">
                                 {% for mem in memory_range %}
                                 <option value="{{ mem }}"
                                 {% if mem == cur_memory %}selected{% endif %}>{{ mem }}</option>
                                 {% endfor %}
                                 </select>
                                 <input type="text" name="cur_memory_custom" class="form-control js-custom__toggle" style="display: none" />
                                 <small><input type="checkbox" class="js-custom__checkbox" />  Custom value </small>
                              </div>
                           </div>
                           <div class="form-group">
                              <label class="col-sm-4 control-label"
                                 style="font-weight:normal;"> Maximum allocation  ( MB )</label>
                              <div class="col-sm-4 js-custom__container">
                                 <select name="memory" class="form-control js-custom__toggle">
                                 {% for mem in memory_range %}
                                 <option value="{{ mem }}"
                                 {% if mem == memory %}selected{% endif %}>{{ mem }}</option>
                                 {% endfor %}
                                 </select>
                                 <input type="text" name="memory_custom" class="form-control js-custom__toggle" style="display: none" />
                                 <small><input type="checkbox" class="js-custom__checkbox" />  Custom value </small>
                              </div>
                           </div>
                           {% if entry.status == "1" %}
                           <button type="submit" class="btn btn-lg btn-success pull-right" name="resize"> Resize </button>
                           {% else %}
                           <button class="btn btn-lg btn-success pull-right disabled"> Resize </button>
                           {% endif %}
                        </form>
                        <div class="clearfix"></div>
                     </div>
                  </div>
               </div>
            </div>
            <div role="tabpanel" class="tab-pane" id="snapshots">
               <div role="tabpanel">
                  <!-- Nav tabs -->
                  <ul class="nav nav-tabs" role="tablist">
                     <li role="presentation" class="active">
                        <a href="#takesnapshot" aria-controls="takesnapshot" role="tab" data-toggle="tab">
                        Take Snapshot
                        </a>
                     </li>
                     <li role="presentation">
                        <a href="#restoresnapshot" aria-controls="restoresnapshot" role="tab" data-toggle="tab">
                        Restore From Snapshot
                        </a>
                     </li>
                  </ul>
                  <!-- Tab panes -->
                  <div class="tab-content">
                     <div role="tabpanel" class="tab-pane tab-pane-bordered active" id="takesnapshot">
                        {% if entry.status == "1" %}
                        <p> This may take more than an hour, depending on how much content is on your droplet and how large the disk is. </p>
                        <form class="form-inline" method="post" role="form">
                           <div class="form-group">
                              <div class="col-sm-12">
                                 <input type="text" class="form-control input-lg" name="name" placeholder=" Enter Snapshot Name " maxlength="14">
                              </div>
                           </div>
                           {% if entry.status == "1" %}
                           <input type="submit" class="btn btn-lg btn-success pull-right" name="snapshot" value=" Take Snapshot ">
                           {% else %}
                           <button class="btn btn-lg btn-success pull-right disabled"> Take Snapshot </button>
                           {% endif %}
                        </form>
                        <div class="clearfix"></div>
                        {% else %}
                        <p> To take a snapshot please Power Off the instance. </p>
                        {% endif %}
                     </div>
                  </div>
               </div>
            </div>
            <div role="tabpanel" class="tab-pane" id="settings">
               <div role="tabpanel">
                  <!-- Nav tabs -->
                  <ul class="nav nav-tabs" role="tablist">
                     <li role="presentation" class="active">
                        <a href="#media" aria-controls="media" role="tab" data-toggle="tab">
                        Media
                        </a>
                     </li>
                     <li role="presentation">
                        <a href="#autostart" aria-controls="autostart" role="tab" data-toggle="tab">
                        Autostart
                        </a>
                     </li>
                     <li role="presentation">
                        <a href="#vncsettings" aria-controls="vncsettings" role="tab" data-toggle="tab">
                        VNC
                        </a>
                     </li>
                     <li role="presentation">
                        <a href="#clone" aria-controls="clone" role="tab" data-toggle="tab">
                        Clone
                        </a>
                     </li>
                     <li role="presentation">
                        <a href="#migrate" aria-controls="migrate" role="tab" data-toggle="tab">
                        Migrate
                        </a>
                     </li>
                     <li role="presentation">
                        <a href="#xmledit" aria-controls="xmledit" role="tab" data-toggle="tab">
                        XML
                        </a>
                     </li>
                  </ul>
                  <!-- Tab panes -->
                  <div class="tab-content">
                     <div role="tabpanel" class="tab-pane tab-pane-bordered active" id="media">
                        <form class="form-horizontal" action="" method="post" role="form">
                           {% for cd in media %}
                           <div class="form-group">
                              <label class="col-sm-2 control-label"> CDROM  {{ forloop.counter }}</label>
                              {% if not cd.image %}
                              <div class="col-sm-6">
                                 <select name="media" class="form-control">
                                    {% if media_iso %}
                                    {% for iso in media_iso %}
                                    <option value="{{ iso }}">{{ iso }}</option>
                                    {% endfor %}
                                    {% else %}
                                    <option value="none"> None </option>
                                    {% endif %}
                                 </select>
                              </div>
                              <div class="col-sm-2">
                                 {% if media_iso %}
                                 <button type="submit" class="btn btn-sm btn-success pull-left" name="mount_iso" value="{{ cd.dev }}" style="margin-top: 2px;"> Mount </button>
                                 {% else %}
                                 <button class="btn btn-sm btn-success pull-left disabled" name="mount_iso" style="margin-top: 2px;"> Mount </button>
                                 {% endif %}
                              </div>
                              {% else %}
                              <div class="col-sm-5">
                                 <p>{{ cd.image }}</p>
                              </div>
                              <div class="col-sm-2">
                                 <input type="hidden" name="path" value="{{ cd.path }}">
                                 <button type="submit" class="btn btn-sm btn-success pull-left" value="{{ cd.dev }}" name="umount_iso" style="margin-top: 2px;"> Umount </button>
                              </div>
                              {% endif %}
                           </div>
                           {% endfor %}
                        </form>
                        <div class="clearfix"></div>
                     </div>
                     <div role="tabpanel" class="tab-pane tab-pane-bordered" id="autostart">
                        <p> Autostart your instance when host server is power on </p>
                        <form class="form-horizontal" action="" method="post" role="form">
                           {% if entry.status == "1" %}
                           <input type="submit" class="btn btn-lg btn-success pull-right" name="set_autostart" value=" Enable ">
                           {% else %}
                           <input type="submit" class="btn btn-lg btn-success pull-right" name="unset_autostart" value=" Disable ">
                           {% endif %}
                        </form>
                        <div class="clearfix"></div>
                     </div>
                     <div role="tabpanel" class="tab-pane tab-pane-bordered" id="vncsettings">
                        <p> To set console's type, shutdown the instance. </p>
                        <form class="form-horizontal" method="post" role="form">
                           <div class="form-group" id="console_type_selection">
                              <label for="console_select_type" class="col-sm-2 control-label"> Type </label>
                              <div class="col-sm-6">
                                 <select id="console_select_type" class="form-control" name="console_type">
                                    <option value="" style="font-weight: bold"> please choose </option>
                                    {% for ctype in console_types %}
                                    <option value="{{ ctype }}">{{ ctype }}</option>
                                    {% endfor %}
                                 </select>
                              </div>
                              <div class="col-sm-3">
                                 {% if entry.status == "1" %}
                                 <button type="submit" class="btn btn-success " name="set_console_type"> Set </button>
                                 {% else %}
                                 <button class="btn btn-success disabled" name="set_console_type"> Set </button>
                                 {% endif %}
                              </div>
                           </div>
                        </form>
                        <p> To create console password, shutdown the instance. </p>
                        <form class="form-horizontal" method="post" role="form">
                           <div class="form-group">
                              <div class="col-sm-offset-2 col-sm-10">
                                 <div class="checkbox">
                                    <label>
                                    <input type="checkbox" name="auto_pass" value="true" id="console_passwd_gen"> Generate
                                    </label>
                                 </div>
                                 <div class="checkbox">
                                    <label>
                                    <input type="checkbox" name="clear_pass" value="true" id="console_passwd_clear"> Clear
                                    </label>
                                 </div>
                              </div>
                           </div>
                           <div class="form-group">
                              <label for="inputPassword1" class="col-sm-2 control-label"> Password </label>
                              <div class="col-sm-6" id="console_passwd_manual">
                                 <input id="console_show_pass" type="password" class="form-control" name="console_passwd"
                                 {% if console_passwd %}
                                 value="{{ console_passwd }}"
                                 {% else %}
                                 placeholder=" Password "
                                 {% endif %} maxlength="14">
                              </div>
                              <div class="col-sm-3">
                                 {% if console_passwd %}
                                 <a href="#" name="console_show" class="btn btn-primary btn-md" onclick="show_console()"> Show </a>
                                 {% endif %}
                                 {% if entry.status == "1" %}
                                 <button type="submit" class="btn btn-success" name="set_console_passwd"> Set </button>
                                 {% else %}
                                 <button class="btn btn-success disabled" name="set_console_passwd"> Set </button>
                                 {% endif %}
                              </div>
                           </div>
                        </form>
                        <p> To set console's keymap, shutdown the instance. </p>
                        <form class="form-horizontal" method="post" role="form">
                           <div class="form-group">
                              <div class="col-sm-offset-2 col-sm-10">
                                 <div class="checkbox">
                                    <label>
                                    <input type="checkbox" name="clear_keymap" value="true" id="console_keymap_clear"> Clear
                                    </label>
                                 </div>
                              </div>
                           </div>
                           <div class="form-group" id="console_keymap_selection">
                              <label for="console_select_keymap" class="col-sm-2 control-label"> Keymap </label>
                              <div class="col-sm-6">
                                 <select id="console_select_keymap" class="form-control" name="console_keymap">
                                    <option value="" style="font-weight: bold"> please choose </option>
                                    {% for keymap in keymaps %}
                                    <option value="{{ keymap }}">{{ keymap }}</option>
                                    {% endfor %}
                                 </select>
                              </div>
                              <div class="col-sm-3">
                                 {% if entry.status == "1" %}
                                 <button type="submit" class="btn btn-success" name="set_console_keymap"> Set </button>
                                 {% else %}
                                 <button class="btn btn-success disabled" name="set_console_keymap"> Set </button>
                                 {% endif %}
                              </div>
                           </div>
                        </form>
                        <div class="clearfix"></div>
                     </div>
                     <div role="tabpanel" class="tab-pane tab-pane-bordered" id="clone">
                        <p style="font-weight:bold;"> Create a clone </p>
                        <form class="form-horizontal" action="" method="post" role="form">
                           <div class="form-group">
                              <label class="col-sm-3 control-label" style="font-weight:normal;"> Clone Name </label>
                              <div class="col-sm-3">
                                 <input type="text" class="form-control" name="name" value="{{ vname }}-clone"/>
                              </div>
                           </div>
                           <p style="font-weight:bold;"> Network devices </p>
                           {% for network in networks %}
                           <div class="form-group">
                              <label class="col-sm-3 control-label" style="font-weight:normal;">eth{{ forloop.counter0 }} ({{ network.nic }})</label>
                              <div class="col-sm-3">
                                 <input type="text" class="form-control" name="net-{{ forloop.counter0 }}" value="{{ network.mac }}"/>
                              </div>
                              <div class="col-sm-1">
                                 <button type="button" class="btn btn-sm btn-success pull-left" name="random-mac-{{ forloop.counter0 }}"
                                    onclick="random_mac({{ forloop.counter0 }})" style="margin-top: 2px;"> Random </button>
                              </div>
                           </div>
                           {% endfor %}
                           <p style="font-weight:bold;"> Storage devices </p>
                           {% for disk in clone_disks %}
                           <div class="form-group">
                              <label class="col-sm-3 control-label" style="font-weight:normal;">{{ disk.dev }} ({{ disk.storage }})</label>
                              <div class="col-sm-3">
                                 <input type="text" class="form-control" name="disk-{{ disk.dev }}" value="{{ disk.image }}"/>
                              </div>
                              <label class="col-sm-2 control-label" style="font-weight:normal;margin-left:-35px;">Metadata</label>
                              <div class="col-sm-1">
                                 <input type="checkbox" name="meta-{{ disk.dev }}" value="true" style="margin-top: 10px;">
                              </div>
                           </div>
                           {% endfor %}
                           {% if entry.status == "1" %}
                           <button type="submit" class="btn btn-lg btn-success pull-right" name="clone"> Clone </button>
                           {% else %}
                           <button class="btn btn-lg btn-success pull-right disabled" name="clone"> Clone </button>
                           {% endif %}
                        </form>
                        <div class="clearfix"></div>
                     </div>
                     <div role="tabpanel" class="tab-pane tab-pane-bordered" id="migrate">
                        <p> For migration both host servers must have equal settings and OS type </p>
                        <form class="form-horizontal" method="post" role="form">
                           <div class="form-group">
                              <label class="col-sm-3 control-label"> Original host </label>
                              <div class="col-sm-6">
                                 <p style="margin: 10px -10px 0 0;">XXXXXX</p>
                              </div>
                           </div>
                           <div class="form-group">
                              <label class="col-sm-3 control-label"> Host migration </label>
                              <div class="col-sm-6">
                                 <select name="compute_id" class="form-control">
                                    {% if computes_count != 1 %}
                                    {% for comp in computes %}
                                    {% if comp.id != compute.id %}
                                    <option value="{{ comp.id }}">{{ comp.name }}</option>
                                    {% endif %}
                                    {% endfor %}
                                    {% endif %}
                                 </select>
                              </div>
                           </div>
                           <div class="form-group">
                              <label class="col-sm-3 control-label"> Live migration </label>
                              <div class="col-sm-6">
                                 <input type="checkbox" name="live_migrate" value="true" id="vm_live_migrate">
                              </div>
                           </div>
                           <div class="form-group">
                              <label class="col-sm-3 control-label"> Unsafe migration </label>
                              <div class="col-sm-6">
                                 <input type="checkbox" name="unsafe_migrate" value="true" id="vm_unsafe_migrate">
                              </div>
                           </div>
                           <div class="form-group">
                              <label class="col-sm-3 control-label"> Delete original </label>
                              <div class="col-sm-6">
                                 <input type="checkbox" name="xml_delete" value="true" id="xml_delete">
                              </div>
                           </div>
                           {% if computes_count != 1 %}
                           <button type="submit" class="btn btn-lg btn-success pull-right" name="migrate"> Migrate </button>
                           {% else %}
                           <button class="btn btn-lg btn-success pull-right disabled"> Migrate </button>
                           {% endif %}
                        </form>
                        <div class="clearfix"></div>
                        </p>
                     </div>
                     <div role="tabpanel" class="tab-pane tab-pane-bordered" id="xmledit">
                        <p> If you need to edit xml please Power Off the instance </p>
                        <form class="form-horizontal" method="post" role="form">
                           <div class="col-sm-12" id="xmlheight">
                              <textarea id="editor">{{ inst_xml }}</textarea>
                           </div>
                           {% if entry.status == "1" %}
                           <input type="hidden" name="inst_xml">
                           <button type="submit" class="btn btn-lg btn-success pull-right" name="change_xml">
                           Change
                           </button>
                           {% else %}
                           <button class="btn btn-lg btn-success pull-right disabled">
                           Change
                           </button>
                           {% endif %}
                        </form>
                        <div class="clearfix"></div>
                     </div>
                     {% endif %}
                  </div>
               </div>
            </div>
            <div role="tabpanel" class="tab-pane" id="graphics">
               <div role="tabpanel">
                  <!-- Nav tabs -->
                  <ul class="nav nav-tabs" role="tablist">
                     <li role="presentation" class="active">
                        <a href="#graphs" aria-controls="graphs" role="tab" data-toggle="tab">
                        Real Time
                        </a>
                     </li>
                  </ul>
                  <!-- Tab panes -->
                  <div class="tab-content">
                     <div role="tabpanel" class="tab-pane tab-pane-bordered active" id="graphs">
                        <div class="panel panel-success">
                           <div class="panel-heading">
                              <h3 class="panel-title"><i class="fa fa-long-arrow-right"></i>  CPU usage </h3>
                           </div>
                           <div class="panel-body">
                              <div class="flot-chart">
                                 <div class="flot-chart-content" id="flot-moving-line-chart" style="padding: 0px; position: relative;">
                                    <canvas id="cpuChart" width="735" height="160"></canvas>
                                 </div>
                              </div>
                           </div>
                        </div>
                        {% for net in networks %}
                        <div class="panel panel-info">
                           <div class="panel-heading">
                              <h3 class="panel-title"><i class="fa fa-long-arrow-right"></i>  Bandwidth device:  eth{{ forloop.counter0 }}</h3>
                           </div>
                           <div class="panel-body">
                              <div class="flot-chart">
                                 <div class="flot-chart-content" id="flot-moving-line-chart" style="padding: 0px; position: relative;">
                                    <canvas id="netEth{{ forloop.counter0 }}Chart" width="735" height="160"></canvas>
                                 </div>
                              </div>
                           </div>
                        </div>
                        {% endfor %}
                        {% for disk in disks %}
                        <div class="panel panel-warning">
                           <div class="panel-heading">
                              <h3 class="panel-title"><i class="fa fa-long-arrow-right"></i>  Disk I/O device:  {{ disk.dev }}</h3>
                           </div>
                           <div class="panel-body">
                              <div class="flot-chart">
                                 <div class="flot-chart-content" id="flot-moving-line-chart" style="padding: 0px; position: relative;">
                                    <canvas id="blk{{ disk.dev }}Chart" width="735" height="160"></canvas>
                                 </div>
                              </div>
                           </div>
                        </div>
                        {% endfor %}
                        <div class="clearfix"></div>
                     </div>
                  </div>
               </div>
            </div>
            <div role="tabpanel" class="tab-pane" id="undefine">
               <div role="tabpanel">
                  <!-- Nav tabs -->
                  <ul class="nav nav-tabs" role="tablist">
                     <li role="presentation" class="active">
                        <a href="#destroy" aria-controls="destroy" role="tab" data-toggle="tab">
                        Destroy Instance
                        </a>
                     </li>
                  </ul>
                  <!-- Tab panes -->
                  <div class="tab-content">
                     <div role="tabpanel" class="tab-pane tab-pane-bordered active" id="destroy">
                        <p> Delete storage for instance? </p>
                        {% if entry.status == "1" %}
                        <button class="btn btn-lg btn-success disabled pull-right" name="delete"> Destroy </button>
                        {% else %}
                        <form class="form-group" method="post" role="form">
                           <div class="checkbox" style="margin-left: 8px;">
                              <label>
                              <input type="checkbox" name="delete_disk" value="true">
                              <strong> Remove Instance's data </strong>
                              </label>
                           </div>
                           <button type="submit" class="btn btn-lg btn-success pull-right" name="delete"> Destroy </button>
                        </form>
                        {% endif %}
                        <button class="btn btn-lg btn-success disabled pull-right" name="delete"> Destroy </button>
                        <div class="clearfix"></div>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>
   </div>
</div>

<script src="{{ url_for('static', filename='/js/ace.js') }}" type="text/javascript" charset="utf-8"></script>
<script>
   var editor = ace.edit("editor");
   editor.getSession().setMode("ace/mode/xml");

   var input = $('input[name="inst_xml"]');
       editor.getSession().on("change", function () {
       input.val(editor.getSession().getValue());
   });
</script>
<script>
   function open_console() {
       window.open('/console?token={{ compute_id }}-{{ uuid }}', '', 'width=850,height=485')
   }
</script>
<script>
   function random_mac(net) {
       var hexDigits = "0123456789abcdef";
       var macAddress="52:54:00:";
       for (var i=0; i<3; i++) {
           macAddress+=hexDigits.charAt(Math.round(Math.random()*16));
           macAddress+=hexDigits.charAt(Math.round(Math.random()*16));
           if (i != 2) macAddress+=":";
       }
       $('input[name="net-'+net+'"]').val(macAddress);
   };
</script>
<script>
   function show_console() {
       if ($('#console_show_pass').attr('type') == 'password') {
           $('#console_show_pass').attr('type', 'text');
       } else {
           $('#console_show_pass').attr('type', 'password');
       }
   }
</script>
<script>
   $(document).on('change', '#console_passwd_gen', function () {
       if ($(this).prop('checked')) {
           $('#console_passwd_manual').hide();
           $('#console_passwd_clear').prop('checked', false);
       } else {
           $('#console_passwd_manual').show();
       }
   });
   $(document).on('change', '#console_passwd_clear', function () {
       if ($(this).prop('checked')) {
           $('#console_passwd_manual').hide();
           $('#console_passwd_gen').prop('checked', false);
       } else {
           $('#console_passwd_manual').show();
       }
   });
   $(document).on('change', '#console_keymap_clear', function () {
       if ($(this).prop('checked')) {
           $('#console_keymap_selection').hide();
       } else {
           $('#console_keymap_selection').show();
       }
   });
   $(document).ready(function () {
       // set current console keymap or fall back to default
       var keymap = "{{ console_keymap }}"
       if (keymap != '') {
           $("#console_select_keymap option[value='" + keymap + "']").prop('selected', true);
       }
   });
   $(document).ready(function () {
       // set current console type or fall back to default
       var console_type = "{{ console_type }}"
       if (console_type != '') {
           $("#console_select_type option[value='" + console_type + "']").prop('selected', true);
       }
   });
</script>
<script>
   $(function () {
       $('.js-custom__checkbox').change(function () {
           var container  = $(this).closest('.js-custom__container');
           var toggles     = container.find('.js-custom__toggle');
           toggles.toggle();
       });
   });
</script>
<script src="{{ url_for('static', filename='/js/Chart.min.js') }}"></script>
<script>
   $('#chartgraphs').on('shown.bs.tab', function (event) {
       var cpuLineData = {
           labels : [0, 0, 0, 0, 0],
           datasets : [
               {
                   fillColor: "rgba(44,127,184,0.5)",
                   strokeColor: "rgba(44,127,184,1)",
                   pointColor: "rgba(44,127,184,1)",
                   pointStrokeColor: "#fff",
                   data: [0, 0, 0, 0, 0]
               }
           ]
       };
       var diskLineData = {
           labels : [0, 0, 0, 0, 0],
           datasets : [
               {
                   fillColor: "rgba(127,205,187,0.5)",
                   strokeColor: "rgba(127,205,187,1)",
                   pointColor: "rgba(127,205,187,1)",
                   pointStrokeColor: "#fff",
                   data: [0, 0, 0, 0, 0],
                   label: "Read"
               },
               {
                   fillColor: "rgba(44,127,184,0.5)",
                   strokeColor: "rgba(44,127,184,1)",
                   pointColor: "rgba(44,127,184,1)",
                   pointStrokeColor: "#fff",
                   data: [0, 0, 0, 0, 0],
                   label: "Write"
               },
           ]
       };
       var netLineData = {
           labels : [0, 0, 0, 0, 0],
           datasets : [
              {
                   fillColor: "rgba(127,205,187,0.5)",
                   strokeColor: "rgba(127,205,187,1)",
                   pointColor: "rgba(127,205,187,1)",
                   pointStrokeColor: "#fff",
                   data: [0, 0, 0, 0, 0],
                   label: "Inbound"
              },
              {
                   fillColor: "rgba(44,127,184,0.5)",
                   strokeColor: "rgba(44,127,184,1)",
                   pointColor: "rgba(44,127,184,1)",
                   pointStrokeColor: "#fff",
                   data: [0, 0, 0, 0, 0],
                   label: "Outbound"
              },
           ]
       };
       var cpuOpt = {
           animation: false,
           pointDotRadius: 2,
           scaleLabel: "<%=value%> %",
           tooltipTemplate: "<%=value%> %",
           scaleShowGridLines : false,
           scaleOverride: true,
           scaleSteps: 5,
           scaleStepWidth: 20,
           scaleStartValue: 0,
           responsive: true
       };
       var diskOpt = {
           animation: false,
           pointDotRadius: 2,
           scaleLabel: "<%=value%> Mb/s",
           multiTooltipTemplate: "<%=datasetLabel%> - <%=value%> Mb/s",
           scaleShowGridLines : false,
           responsive: true
       };
       var netOpt = {
           animation: false,
           pointDotRadius: 2,
           scaleLabel: "<%=value%> Mbps",
           multiTooltipTemplate: "<%=datasetLabel%> - <%=value%> Mbps",
           scaleShowGridLines : false,
           responsive: true,
       };

       var cpu_ctx = $("#cpuChart").get(0).getContext("2d");
       var cpuChart = new Chart(cpu_ctx).Line(cpuLineData, cpuOpt);

       var diskChart = {};
       {% for disk in disks %}
           var disk_ctx_{{ disk.dev }} = $("#blk{{ disk.dev }}Chart").get(0).getContext("2d");
           diskChart['{{ disk.dev }}'] = new Chart(disk_ctx_{{ disk.dev }}).Line(diskLineData, diskOpt);
       {% endfor %}

       var netChart = {};
       {% for net in networks %}
           var net_ctx_{{ forloop.counter0 }} = $("#netEth{{ forloop.counter0 }}Chart").get(0).getContext("2d");
           netChart['{{ forloop.counter0 }}'] = new Chart(net_ctx_{{ forloop.counter0 }}).Line(netLineData, netOpt);
       {% endfor %}

       window.setInterval(function graph_usage() {
           $.getJSON('xxx', function (data) {
               cpuChart.scale.xLabels = data.timeline;
               for (var i = 0; i < data.cpudata.length; i++) {
                   cpuChart.datasets[0].points[i].value = data.cpudata[i];
               }
               cpuChart.update();

               for (var j = 0; j < data.blkdata.length; j++) {
                   diskChart[data.blkdata[j].dev].scale.xLabels = data.timeline;

                   for (var i = 0; i < data.blkdata[j].data[0].length; i++) {
                       diskChart[data.blkdata[j].dev].datasets[0].points[i].label = 'Time: ' + data.timeline[i];
                       diskChart[data.blkdata[j].dev].datasets[0].points[i].value = data.blkdata[j].data[0][i];
                       diskChart[data.blkdata[j].dev].datasets[1].points[i].value = data.blkdata[j].data[1][i];
                   }

                   diskChart[data.blkdata[j].dev].update();
               }

               for (var j = 0; j < data.netdata.length; j++) {
                   netChart[data.netdata[j].dev].scale.xLabels = data.timeline;

                   for (var i = 0; i < data.netdata[j].data[0].length; i++) {
                       netChart[data.netdata[j].dev].datasets[0].points[i].label = 'Time: ' + data.timeline[i];
                       netChart[data.netdata[j].dev].datasets[0].points[i].value = data.netdata[j].data[0][i];
                       netChart[data.netdata[j].dev].datasets[1].points[i].value = data.netdata[j].data[1][i];
                   }

                   netChart[data.netdata[j].dev].update();
               }
           });
       }, 10000);
   });
</script>
<script>
   window.setInterval(function get_status() {
       var status = {{ status }};
       $.getJSON('xxx', function (data) {
           if (data['status'] != status) {
               window.location.reload()
           }
       })
   }, 5000);
</script>
<script>
   var hash = location.hash;
   if (~$.inArray(hash, ['#poweron', '#poweroff', '#powercycle', '#suspend', '#resume'])) {
       var btnsect = $('#navbtn>li>a');
       $(btnsect).each(function () {
           if ($(this).attr('href') === '#power') {
               $(this).trigger('click');
           }
       });
   }
   if (~$.inArray(hash, ['#resize'])) {
       var btnsect = $('#navbtn>li>a');
       $(btnsect).each(function () {
           if ($(this).attr('href') === '#resize') {
               $(this).trigger('click');
           }
       });
   }
   if (~$.inArray(hash, ['#media', '#clone', '#autostart', '#xmledit', '#vncsettings', '#migrate'])) {
       var btnsect = $('#navbtn>li>a');
       $(btnsect).each(function () {
           if ($(this).attr('href') === '#settings') {
               $(this).trigger('click');
           }
       });

       var btn = $('#settings>div>ul>li>a');
       $(btn).each(function () {
           if ($(this).attr('href') === hash) {
               $(this).trigger('click');
           }
       });
   }
   if (~$.inArray(hash, ['#takesnapshot', '#restoresnapshot'])) {
       var btnsect = $('#navbtn>li>a');
       $(btnsect).each(function () {
           if ($(this).attr('href') === '#snapshots') {
               $(this).trigger('click');
           }
       });

       var btn = $('#snapshots>div>ul>li>a');
       $(btn).each(function () {
           if ($(this).attr('href') === hash) {
               $(this).trigger('click');
           }
       });
   }
</script>
{% endblock %}
